#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Check if dependencies are installed
if [ ! -d "node_modules" ] || [ ! -f "node_modules/.bin/vitest" ]; then
  echo "âš ï¸  Dependencies not installed. Skipping pre-push checks."
  echo "ğŸ’¡ Run 'npm install' to enable pre-push test and lint checks."
  exit 0
fi

echo "ğŸ§ª Running tests before push..."
npm run test -- --bail=1
test_status=$?

echo "ğŸ§¹ Running lint before push..."
npm run lint
lint_status=$?

# Block push if either fails
if [ $test_status -ne 0 ] || [ $lint_status -ne 0 ]; then
  echo "âŒ Push blocked: Lint or test failed."
  exit 1
fi

echo "âœ… All checks passed. Proceeding with push..."